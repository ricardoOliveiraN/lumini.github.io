<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumini</title>
    <link rel="icon" href="./Imagens/iconeLuz.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/styleDash-Geral.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .class_kpiNumero {
            width: 80px;
        }
        .class_kpisMenu {
            padding: 40px 20px;
        }
        .class_kpiTexto{
            font-size: 16.8px;
        }
    </style>
</head>
<script data-jsd-embedded data-key="c1c8f828-306c-4170-bbb7-1b74655c36af"
    data-base-url="https://jsd-widget.atlassian.com" src="https://jsd-widget.atlassian.com/assets/embed.js"></script>

<body>
    <main>
        <div class="class_menuLateral">
            <div class="class_LinksMenu">
                <ul>
                    <li><a href="TelaDash-Geral.html">
                            <img src="./Imagens/logo-sem-fundo.png" alt="Logotipo da empresa Lumini">
                        </a>
                    </li>
                    <li><a href="TelaDash-Geral.html">Dashboard</a></li>
                    <li><a href="CadastrarUsuario.html">Funcionários</a></li>
                    <li><a href="SimuladorCliente.html">Simulador</a></li>
                    <li><a href="TelaPerfil.html">Perfil</a></li>
                    <li><a href="./BobIA/public/index.html">BobIA</a></li>
                    <li id="id_btnSair"><a href="TelaLogin.html">Sair</a></li>
                </ul>
            </div>
        </div>
        </div>
        <div class="class_dashs">
            <div class="class_dashCima">
                <div class="class_tituloDash">
                    <h1>Dashboard Sensor 1.3</h1>
                </div>

                <div class="class_talhoesSelecionar">
                    <div class="class_talhoesSelecionarOpcoes">
                        <div class="class_talhoesSelecionarOpcao">
                            <a href="TelaDash-Talhao.html">Talhão 2</a>
                        </div>
                        <div class="class_talhoesSelecionarOpcao">
                            <a href="TelaDash-Geral.html">Todos Talhões</a>
                        </div>
                    </div>
                </div>

            </div>
            <!-- <div class="class_dashBaixo"> -->
            <div class="class_talhoesGraficosContainer">
                <!-- <div class="class_talhoesGraficosTitulo">
                            Todos os Talhões
                        </div> -->
                <div class="class_talhoesGraficos">
                    <div class="class_talhoesGrafico class_talhoesGrafico1">
                        <canvas id="myChartA" style="position: relative; height: 20vh; width: 34.5vw;"></canvas>
                    </div>
                    <div class="class_talhoesGrafico class_talhoesGrafico2">
                        <canvas id="myChartB" style="position: relative; height: 40vh; width: 34.5vw; margin: 24px 0px;"></canvas>
                    </div>
                </div>
            </div>
            <!-- </div> -->
            <div class="container-AlertaeSelecionar">
                <div class="class_talhoesSelecionar">
                    <div class="class_kpisMenu">
                        <div class="class_kpi class_kpi1">
                            <div class="class_kpiNumero">
                                <span>1640</span>
                            </div>
                            <div class="class_kpiTexto">
                                <span>Média Luminosidade</span>
                            </div>
                        </div>
                        <div class="class_kpi class_kpi1">
                            <div class="class_kpiNumero">
                                <span>15,87</span>
                            </div>
                            <div class="class_kpiTexto">
                                <span>Média horas com luz</span>
                            </div>
                        </div>
                        <!-- </div> -->
                        <!-- </div> -->
                    </div>
                </div>
                <div class="class_sensorAlertas">
                    <table>
                        <thead>
                            <tr class="tituloAlerta">
                                <th>Talhao</th>
                                <th>Sensor</th>
                                <th>Tipo</th>
                                <th>Horas</th>
                                <th>Dia</th>
                            </tr>
                            <tr>
                                <th>01</th>
                                <th>1.2</th>
                                <th>Insuficiente</th>
                                <th>14</th>
                                <th>20/09/24</th>
                            </tr>
                            <tr>
                                <th>01</th>
                                <th>1.1</th>
                                <th>Excesso</th>
                                <th>18</th>
                                <th>22/09/24</th>
                            </tr>
                            <tr>
                                <th>02</th>
                                <th>1.3</th>
                                <th>Insuficiente</th>
                                <th>14.5</th>
                                <th>24/10/24</th>
                            </tr>
                        </thead>
                        <tbody id="tableCampo">
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

    </main>
</body>

</html>

<script>

    var dataValues = [0, 0, 0, 0, 0, 400, 3000, 10000, 20000, 30000, 40000, 45000, 50000, 45000, 40000, 30000, 20000, 10000, 10000, 10000, 10000, 0, 0];
    var backGroundValues = [];
    var qtdVezes = 0;

    for (var contador = 0; contador < dataValues.length; contador++) {

        if (dataValues[contador] == 10000 && dataValues[contador + 1] == 10000) {

            backGroundValues.push('rgb(255, 0, 0)');
        } else {

            backGroundValues.push('rgba(75, 192, 192, 0.6)');
        }

    }



    // Primeiro Gráfico

    const labelsA = [
        '00:00',
        '01:00',
        '02:00',
        '03:00',
        '04:00',
        '05:00',
        '06:00',
        '07:00',
        '08:00',
        '09:00',
        '10:00',
        '11:00',
        '12:00',
        '13:00',
        '14:00',
        '15:00',
        '16:00',
        '17:00',
        '18:00',
        '19:00',
        '20:00',
        '21:00',
        '22:00',
        '23:00',
    ];

    const dataA = {
        labels: labelsA,
        datasets: [{
            label: 'Tempo com luz',
            borderColor: backGroundValues,
            backgroundColor: backGroundValues,
            data: dataValues
        },
        ]
    };

    const configA = {
        type: 'line',
        data: dataA,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Luminosidade: 06/10/24'
                }
            }
        }
    }


    // Segundo Gráfico

    const labelsB = [
        '23/09',
        '24/09',
        '25/09',
        '26/09',
        '27/09',
        '28/09',
        '29/09',
        '30/09',
        '01/10',
        '02/10',
        '03/10',
        '04/10',
        '05/10',
        '06/10',
    ];

    const dataB = {
        labels: labelsB,
        datasets: [{
            label: 'Tempo com luz',
            backgroundColor: 'rgb(228, 225, 67, 0.7)',
            borderColor: 'rgb(124, 198, 116, 0.7)',

            data: [16, 16, 16, 14, 16, 16, 16, 15, 16, 16, 16, 17, 16, 16, 20]
        },
        {
            label: 'Meta diária',
            backgroundColor: 'rgb(138, 141, 144)',
            borderColor: 'rgb(138, 141, 144)',
            data: [15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15],
            type: "line"
        }
        ]
    };

    const configB = {
        type: 'bar',
        data: dataB,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: '14 dias - Luminosidade'
                }
            }
        }
    };
    // GRAFICO EM TEMPO REAL INDEX
    var sensorAnalogico = new Chart(document.getElementById('sensorAnalogico').getContext('2d'), {
        type: 'line',
        data: {
            datasets: [{
                label: 'Sensor 1.2',
                borderColor: '#FF9800',
                backgroundColor: '#FF9800'
            }]
        },
        options: {
            scales: {
                x: {
                    beginAtZero: true
                },
                y: {
                    title: {
                        display: true,
                        text: '(Lux)'
                    },
                    beginAtZero: true,
                },
            },
        }
    })


    var paginacao = {};
    var tempo = {};


    function obterDados(grafico, endpoint) {
        fetch('http://localhost:3300/sensores/' + endpoint)
            .then(response => response.json())
            .then(valores => {
                if (paginacao[endpoint] == null) {
                    paginacao[endpoint] = 0;
                }
                if (tempo[endpoint] == null) {
                    tempo[endpoint] = 0;
                }


                var ultimaPaginacao = paginacao[endpoint];
                paginacao[endpoint] = valores.length;
                valores = valores.slice(ultimaPaginacao);


                valores.forEach((valor) => {
                    if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                        grafico.data.labels.shift();
                        grafico.data.datasets[0].data.shift();
                    }


                    grafico.data.labels.push(tempo[endpoint]++);
                    grafico.data.datasets[0].data.push(parseFloat(valor));
                    grafico.update();
                });
            })
            .catch(error => console.error('Erro ao obter dados:', error));
    }


    setInterval(() => {
        obterDados(sensorAnalogico, 'analogico')
    }, 1000);

    // ATE AQUI O GRAFICO
</script>

<script>
    const myChart = new Chart(
        document.getElementById('myChartA'),
        configA

    )

    const myChart2 = new Chart(
        document.getElementById('myChartB'),
        configB
    )
</script>